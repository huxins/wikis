(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{314:function(a,t,s){"use strict";s.r(t);var e=s(14),n=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"clash"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#clash"}},[a._v("#")]),a._v(" Clash")]),a._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://www.toolfk.com/tool-format-yaml.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("在线YAML工具"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"https://koolclash.js.org/",target:"_blank",rel:"noopener noreferrer"}},[a._v("KoolClash"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/Hackl0us/SS-Rule-Snippet/blob/master/LAZY_RULES/clash.yaml",target:"_blank",rel:"noopener noreferrer"}},[a._v("配置模板"),t("OutboundLink")],1),a._v(" "),t("a",{attrs:{href:"https://github.com/ConnersHua/Profiles/tree/master",target:"_blank",rel:"noopener noreferrer"}},[a._v("神机规则"),t("OutboundLink")],1),a._v(" "),t("a",{attrs:{href:"https://github.com/GeQ1an/Rules/tree/master",target:"_blank",rel:"noopener noreferrer"}},[a._v("GeQ1an"),t("OutboundLink")],1)]),a._v(" "),t("li",[a._v("第三方 web 管理页面 http://clash.razord.top/ http://yacd.haishan.me/")]),a._v(" "),t("li",[t("a",{attrs:{href:"https://blog.e9china.net/tufan/clash-proxy-daili.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("利用clash功能制作透明代理"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"https://0x01.io/2020/02/16/x86-%E8%BD%AF%E8%B7%AF%E7%94%B1%E9%80%8F%E6%98%8E%E4%BB%A3%E7%90%86%E6%9E%84%E5%BB%BA%E6%96%B9%E6%A1%88v2020-02/",target:"_blank",rel:"noopener noreferrer"}},[a._v("x86 软路由透明代理构建方案"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/Dreamacro/clash/issues/158",target:"_blank",rel:"noopener noreferrer"}},[a._v("回环处理"),t("OutboundLink")],1)])]),a._v(" "),t("h2",{attrs:{id:"安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[a._v("#")]),a._v(" 安装")]),a._v(" "),t("ul",[t("li",[a._v("新增用户")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("groupadd")]),a._v(" clash\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("useradd")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-g")]),a._v(" clash "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-M")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" /sbin/nologin clash\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#执行上述命令会需要你填写一些信息酌情填写")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#passwd clash")]),a._v("\n")])])]),t("ul",[t("li",[a._v("进程控制")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vi")]),a._v(" /lib/systemd/system/clash@.service\nsystemctl daemon-reload\nsystemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("enable")]),a._v(" clash@clash\n")])])]),t("p",[a._v("Systemd 配置文件")]),a._v(" "),t("div",{staticClass:"language-ini extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ini"}},[t("code",[t("span",{pre:!0,attrs:{class:"token section"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token section-name selector"}},[a._v("Unit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")])]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("Description")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("A rule based proxy in Go for %i.")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("After")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("network.target")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token section"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token section-name selector"}},[a._v("Service")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")])]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("Type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("simple")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("User")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("%i")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ExecStart")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/home/software/clash/clash -d /home/software/clash")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("Restart")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("on-abort")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("CapabilityBoundingSet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("CAP_NET_BIND_SERVICE")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("AmbientCapabilities")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("CAP_NET_BIND_SERVICE")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token section"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token section-name selector"}},[a._v("Install")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")])]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("WantedBy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("multi-user.target")]),a._v("\n")])])]),t("h2",{attrs:{id:"配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置文件"}},[a._v("#")]),a._v(" 配置文件")]),a._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://github.com/Fndroid/clash_for_windows_pkg/wiki/DNS%E6%B1%A1%E6%9F%93%E5%AF%B9Clash%EF%BC%88for-Windows%EF%BC%89%E7%9A%84%E5%BD%B1%E5%93%8D",target:"_blank",rel:"noopener noreferrer"}},[a._v("DNS污染对Clash（for Windows）的影响"),t("OutboundLink")],1)])]),a._v(" "),t("p",[a._v("clash DNS 请求逻辑：\n(1) 当访问一个域名时， nameserver 与 fallback 列表内的所有服务器并发请求，得到域名对应的 IP 地址。\n(2) clash 将选取 nameserver 列表内，解析最快的结果。\n(3) 若解析结果中，IP 地址属于 国外，那么 clash 将选择 fallback 列表内，解析最快的结果。")]),a._v(" "),t("p",[t("code",[a._v("touch config.yaml")])]),a._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("7890")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("socks-port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("7891")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("redir-port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("7892")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("allow-lan")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("true")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("mode")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" Rule\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("log-level")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" silent\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# external-controller 主要是用于 web 端管理页面，必须监听在 0.0.0.0")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("external-controller")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 0.0.0.0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("9090")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# secret 是进入管理面板所需要的密码，可填可不填，建议填上")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("secret")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"huxin666"')]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# external-ui 表示管理面板的路径")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("external-ui")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" /home/software/clash/web/\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("dns")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("enable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("true")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ipv6")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("false")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("listen")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 0.0.0.0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("53")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("enhanced-mode")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" redir"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("host\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("nameserver")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" 192.168.9.60"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("20053")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("fallback")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" 192.168.9.60"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("20054")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("proxies")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"proxy"')]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" socks5\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("server")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"192.168.9.60"')]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1080")]),a._v("\n    \n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("proxy-groups")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"auto"')]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" url"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("test\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("proxies")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" proxy\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("url")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'http://www.gstatic.com/generate_204'")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("interval")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("300")]),a._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"home-sh-select"')]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" select\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("proxies")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" DIRECT\n\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"leanway-select"')]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" select\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("proxies")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" DIRECT\n    \n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("rules")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" DOMAIN"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("SUFFIX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("google.com"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("auto\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" DOMAIN"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("KEYWORD"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("google"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("auto\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" DOMAIN"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("google.com"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("auto\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" DOMAIN"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("SUFFIX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("ad.com"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("REJECT\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# rename SOURCE-IP-CIDR and would remove after prerelease")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" SRC"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("IP"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("CIDR"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("192.168.1.201/32"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("DIRECT\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# LAN")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" DOMAIN"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("SUFFIX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("local"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("DIRECT\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" IP"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("CIDR"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("127.0.0.0/8"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("DIRECT\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" IP"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("CIDR"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("172.16.0.0/12"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("DIRECT\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" IP"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("CIDR"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("192.168.0.0/16"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("DIRECT\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" IP"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("CIDR"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("10.0.0.0/8"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("DIRECT\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" IP"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("CIDR"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("17.0.0.0/8"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("DIRECT\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" IP"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("CIDR"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("100.64.0.0/10"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("DIRECT\n  \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 最终规则")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" GEOIP"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("CN"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("DIRECT\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" MATCH"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("auto\n")])])]),t("h2",{attrs:{id:"iptables"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#iptables"}},[a._v("#")]),a._v(" Iptables")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"net.ipv4.ip_forward = 1"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">>")]),a._v(" /etc/sysctl.conf "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sysctl")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"net.ipv6.conf.all.forwarding = 1"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">>")]),a._v(" /etc/sysctl.conf "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sysctl")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" /proc/sys/net/ipv4/ip_forward\n\n\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-N")]),a._v(" clash\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" PREROUTING "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" clash\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#注意：这里的网段和IP你需要自己适配自己的")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" clash "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0")]),a._v(".0.0/8 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" RETURN\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" clash "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10.0")]),a._v(".0.0/8 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" RETURN\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" clash "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.0/8 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" RETURN\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" clash "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("169.254")]),a._v(".0.0/16 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" RETURN\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" clash "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("172.16")]),a._v(".0.0/12 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" RETURN\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" clash "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".0.0/16 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" RETURN\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" clash "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("224.0")]),a._v(".0.0/4 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" RETURN\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" clash "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("240.0")]),a._v(".0.0/4 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" RETURN\n\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" clash "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" REDIRECT --to-ports "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("7892")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" OUTPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),a._v(" owner "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!")]),a._v(" --uid-owner clash "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" REDIRECT --to-port "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("7892")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" iptables-persistent\nnetfilter-persistent save\nnetfilter-persistent start\niptables-save  "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" /etc/iptables/rules.v4\n")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);