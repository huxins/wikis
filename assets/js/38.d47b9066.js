(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{322:function(a,t,e){"use strict";e.r(t);var r=e(14),s=Object(r.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"ssr"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ssr"}},[a._v("#")]),a._v(" SSR")]),a._v(" "),t("h2",{attrs:{id:"reference"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#reference"}},[a._v("#")]),a._v(" Reference")]),a._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://github.com/teddysun/shadowsocks_install/tree/master",target:"_blank",rel:"noopener noreferrer"}},[a._v("shadowsocks_install"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/neko-dev/gfw_whitelist",target:"_blank",rel:"noopener noreferrer"}},[a._v("gfw_whitelist"),t("OutboundLink")],1),a._v(" "),t("a",{attrs:{href:"https://github.com/MatcherAny/whitelist.pac",target:"_blank",rel:"noopener noreferrer"}},[a._v("whitelist.pac"),t("OutboundLink")],1),a._v(" "),t("a",{attrs:{href:"https://github.com/pexcn/daily/",target:"_blank",rel:"noopener noreferrer"}},[a._v("daily"),t("OutboundLink")],1),a._v(" "),t("a",{attrs:{href:"https://github.com/ifyour/ipac",target:"_blank",rel:"noopener noreferrer"}},[a._v("ipac"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"https://mikoto10032.github.io/post/%E7%A8%8B%E5%BA%8F%E5%91%98%E9%82%A3%E4%BA%9B%E4%BA%8B/linux%E4%BD%BF%E7%94%A8ssr%E5%AE%A2%E6%88%B7%E7%AB%AF/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Linux使用SSR客户端"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"https://www.duyaoss.com/",target:"_blank",rel:"noopener noreferrer"}},[a._v("毒药测速"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/GameXG/TcpRoute2",target:"_blank",rel:"noopener noreferrer"}},[a._v("TcpRoute2"),t("OutboundLink")],1)])]),a._v(" "),t("h2",{attrs:{id:"透明代理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#透明代理"}},[a._v("#")]),a._v(" 透明代理")]),a._v(" "),t("h3",{attrs:{id:"tcping"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tcping"}},[a._v("#")]),a._v(" tcping")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" tcptraceroute "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("bc")]),a._v("\nyum "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" tcptraceroute "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("bc")]),a._v("\n")])])]),t("p",[t("a",{attrs:{href:"http://www.vdberg.org/~richard/tcpping",target:"_blank",rel:"noopener noreferrer"}},[a._v("©2002-2005 Richard van den Berg"),t("OutboundLink")],1)]),a._v(" "),t("h3",{attrs:{id:"redsocks"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redsocks"}},[a._v("#")]),a._v(" redsocks")]),a._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://blog.newnius.com/setup-global-proxy-with-raspberry-pi.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("在树莓派上搭建全局透明代理网关"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/zfl9/ipt2socks",target:"_blank",rel:"noopener noreferrer"}},[a._v("ipt2socks"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/cybozu-go/transocks",target:"_blank",rel:"noopener noreferrer"}},[a._v("transocks"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/xsm1997/KumaSocks",target:"_blank",rel:"noopener noreferrer"}},[a._v("KumaSocks"),t("OutboundLink")],1)])]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("apk "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),a._v(" redsocks\n")])])]),t("p",[a._v("配置")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("tee")]),a._v(" /etc/redsocks/redsocks.conf "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<<-")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'EOF'\nbase {\n    log_debug = off;\n    log_info = off;\n    log = stderr;\n    daemon = off;\n    redirector = iptables;\n}\nredsocks {\n    local_ip = 0.0.0.0;\n    local_port = 12345;\n    ip = 192.168.11.60;\n    port = 1080;\n    type = socks5;\n}\nEOF")]),a._v("\n")])])]),t("h3",{attrs:{id:"ipset"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ipset"}},[a._v("#")]),a._v(" ipset")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("apk "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),a._v(" ipset\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 下载分配给国内运营商的 IP 段")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'http://ftp.apnic.net/apnic/stats/apnic/delegated-apnic-latest'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" ipv4 "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" CN "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("awk")]),a._v(" -F"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'{ printf(\"%s/%d\\n\", $4, 32-log($5)/log(2)) }'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" chnroute.txt\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 创建一个集合并把上述IP段加进去")]),a._v("\nipset create chnroute hash:net\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" chnroute.txt "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("xargs")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-I")]),a._v(" ip_cn ipset "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),a._v(" chnroute ip_cn\n")])])]),t("h3",{attrs:{id:"iptables-规则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#iptables-规则"}},[a._v("#")]),a._v(" iptables 规则")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" /proc/sys/net/ipv4/ip_forward\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-N")]),a._v(" SHADOWSOCKS\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使代理自己不要再被重定向，不然就无限循环了")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" SHADOWSOCKS "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".11.60 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" RETURN\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 忽略局域网地址")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" SHADOWSOCKS "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0")]),a._v(".0.0/8 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" RETURN\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" SHADOWSOCKS "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10.0")]),a._v(".0.0/8 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" RETURN\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" SHADOWSOCKS "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.0/8 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" RETURN\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" SHADOWSOCKS "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("169.254")]),a._v(".0.0/16 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" RETURN\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" SHADOWSOCKS "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("172.16")]),a._v(".0.0/12 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" RETURN\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" SHADOWSOCKS "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".0.0/16 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" RETURN\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" SHADOWSOCKS "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("224.0")]),a._v(".0.0/4 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" RETURN\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" SHADOWSOCKS "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("240.0")]),a._v(".0.0/4 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" RETURN\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" SHADOWSOCKS "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("set")]),a._v(" --match-set chnroute dst "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" RETURN\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 把流量转发到 12345 端口，即redsocks")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" SHADOWSOCKS "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" REDIRECT --to-ports "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("12345")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" OUTPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" SHADOWSOCKS\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" PREROUTING "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" SHADOWSOCKS\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# DNS 劫持")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" PREROUTING "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" udp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("53")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" REDIRECT --to-ports "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("15353")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" PREROUTING "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("53")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" REDIRECT --to-ports "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("15353")]),a._v("\n")])])])])}),[],!1,null,null,null);t.default=s.exports}}]);