(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{322:function(a,t,s){"use strict";s.r(t);var e=s(14),n=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"vpn"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#vpn"}},[a._v("#")]),a._v(" VPN")]),a._v(" "),t("h2",{attrs:{id:"pptp"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pptp"}},[a._v("#")]),a._v(" PPTP")]),a._v(" "),t("p",[a._v("TCP: 1723")]),a._v(" "),t("h3",{attrs:{id:"windows"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#windows"}},[a._v("#")]),a._v(" Windows")]),a._v(" "),t("p",[a._v("修改windows系统PPTP连接使用的MTU值")]),a._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[a._v("netsh interface ipv4 show interfaces\nnetsh interface ipv4 "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("set")]),a._v(" subinterface "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"31"')]),a._v(" mtu=1396 store=persistent\n")])])]),t("p",[a._v("路由表解释")]),a._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[a._v("route print "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("4\n")])])]),t("p",[a._v("删除默认设置")]),a._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[a._v("route delete 0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("0\n")])])]),t("p",[a._v("内网路由，192.168.10.245为VPN网关")]),a._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[a._v("route add 192"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("168"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("11"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("0 mask 255"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("255"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("255"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("0 192"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("168"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("10"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("245 –p\n")])])]),t("p",[t("a",{attrs:{href:"http://www.jswh.me/%E5%85%B6%E4%BB%96/windows-auto-pptp/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Windows登录自动化 PPTP"),t("OutboundLink")],1)]),a._v(" "),t("div",{staticClass:"language-bat extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("ipconfig | findstr /n 172\\.17\\.0\\.[0-9]*\nIF NOT ERRORLEVEL 1 ( \n    ipconfig | findstr /n 192\\.168\\.10\\.[0-9]*\n    IF ERRORLEVEL 1 ( \n        echo AT COMPANY AND NO PPTP.\n        rasdial <VPN NAME> <USERNAME> <PASSWORD>\n        route ADD 10.0.0.0 MASK 255.0.0.0 10.4.90.1\n    )\n)\n")])])]),t("h3",{attrs:{id:"centos-7"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#centos-7"}},[a._v("#")]),a._v(" CentOS 7")]),a._v(" "),t("p",[a._v("检查是否支持PPTP，满足一条即可")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("modprobe ppp-compress-18 "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" ok "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#返回OK")]),a._v("\nzgrep MPPE /proc/config.gz "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#返回CONFIG_PPP_MPPE=y 或 =m")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" /dev/net/tun "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#返回cat: /dev/net/tun: File descriptor in bad state")]),a._v("\n")])])]),t("p",[a._v("安装 PPP，pptpd")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("yum "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" ppp\nyum "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" epel-release\nyum "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" pptpd\n")])])]),t("p",[a._v("修改dns信息")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vi")]),a._v(" /etc/ppp/options.pptpd\nms-dns "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("119.29")]),a._v(".29.29\nms-dns "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("114.114")]),a._v(".114.114\nnologfd\nlogfile /var/log/pptpd.log\n")])])]),t("p",[a._v("vpn 账户密码")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vi")]),a._v(" /etc/ppp/chap-secrets\nadmin pptpd password * "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# VPN账号 + 服务类型 + VPN密码 + IP")]),a._v("\n")])])]),t("p",[a._v("设置VPN内网IP段")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vi")]),a._v(" /etc/pptpd.conf\nlocalip "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".0.1 "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 服务器的内部网关地址")]),a._v("\nremoteip "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("172.16")]),a._v(".1.100-110 "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 分配给客户端的地址,一般是内网网段地址")]),a._v("\n")])])]),t("p",[a._v("修改内核参数支持内核转发")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vi")]),a._v(" /etc/sysctl.conf\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("net.ipv4.ip_forward")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sysctl")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" /proc/sys/net/ipv4/ip_forward\n")])])]),t("p",[a._v("日志")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 1、上线日志")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vi")]),a._v(" /etc/ppp/ip-up\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$PEERNAME")]),a._v(" 分配IP: "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$5")]),a._v(" 登录IP: "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$6")]),a._v(" 登录时间: "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("date")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" today +%F_%T"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v('"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">>")]),a._v(" /var/log/pptpd.log\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 2、下线日志")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vi")]),a._v(" /etc/ppp/ip-down\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$PEERNAME")]),a._v(" 下线IP: "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$6")]),a._v(" 下线时间: "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("date")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" today +%F_%T"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v('"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">>")]),a._v(" /var/log/pptpd.log\n")])])]),t("p",[a._v("设置最大传输单元")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vi")]),a._v(" /etc/ppp/ip-up\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# exit 0 行前添加")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ifconfig")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$1")]),a._v(" mtu "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1450")]),a._v("\n\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" FORWARD "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--syn")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10.0")]),a._v(".0.0/24 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" TCPMSS --set-mss "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1396")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" FORWARD "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),a._v(" tcp --tcp-flags SYN,RST SYN "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" TCPMSS --clamp-mss-to-pmtu\n")])])]),t("p",[a._v("NAT 转发")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 192.168.9.0/24,取决于你 /etc/pptpd.conf 里的 local IP,表示的是你 VPN 客户端分配的 IP 段.")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" gre "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT \n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1723")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" POSTROUTING "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".0.0/24 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" eth0 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" MASQUERADE\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# iptables -t nat -A POSTROUTING -s 192.168.0.0/255.255.255.0 -o eth0 -j SNAT --to-source 172.27.0.15")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("netstat")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-tunlp")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1723")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# /etc/rc.d/rc.local 自启")]),a._v("\n")])])]),t("h2",{attrs:{id:"openconnect"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#openconnect"}},[a._v("#")]),a._v(" openconnect")]),a._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://beijing2b.com/splitting-network-traffic-based-on-destinations/",target:"_blank",rel:"noopener noreferrer"}},[a._v("野生思科分离隧道"),t("OutboundLink")],1)])]),a._v(" "),t("h2",{attrs:{id:"nebula"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nebula"}},[a._v("#")]),a._v(" nebula")]),a._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://github.com/slackhq/nebula",target:"_blank",rel:"noopener noreferrer"}},[a._v("nebula"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"https://v2ex.com/t/636088",target:"_blank",rel:"noopener noreferrer"}},[a._v("让 Nebula 可以在 Windows 下作为服务自启动"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"https://runtime.pw/nebula-tutorials/",target:"_blank",rel:"noopener noreferrer"}},[a._v("nebula 简单教程"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"https://beijing2b.com/nebula/",target:"_blank",rel:"noopener noreferrer"}},[a._v("nebula初探"),t("OutboundLink")],1)])]),a._v(" "),t("p",[a._v("下载 nebula")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" https://github.com/slackhq/nebula/releases/download/v1.2.0/nebula-linux-amd64.tar.gz\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-zxvf")]),a._v(" nebula-linux-amd64.tar.gz\n")])])]),t("p",[a._v("生成主证书 "),t("code",[a._v("CA")]),a._v("，后面所有节点证书都是这个主证书签名的，这个命令将生成 "),t("code",[a._v("ca.crt")]),a._v(" 与 "),t("code",[a._v("ca.key")])]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("./nebula-cert ca "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-name")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"home-sh"')]),a._v("\n")])])]),t("p",[a._v("为各节点签发证书，分别为lighthouse、buf、win10")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("./nebula-cert sign "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-name")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"lighthouse"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-ip")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"192.168.250.1/24"')]),a._v("\n./nebula-cert sign "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-name")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"win10"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-ip")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"192.168.250.3/24"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-groups")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"g1, g2"')]),a._v("\n./nebula-cert sign "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-name")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"buf"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-ip")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"192.168.250.100/24"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-groups")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"g1, g2"')]),a._v("\n")])])]),t("p",[a._v("配置文件集中管理")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" /etc/nebula\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" ca.crt /etc/nebula\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" lighthouse.* /etc/nebula/\n")])])]),t("p",[a._v("生成一个配置文件")]),a._v(" "),t("blockquote",[t("p",[a._v("https://github.com/slackhq/nebula/blob/master/examples/config.yml")])]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vi")]),a._v(" /etc/nebula/lighthouse-config.yaml\n")])])]),t("p",[a._v("内容如下")]),a._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("pki")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ca")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" /etc/nebula/ca.crt\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("cert")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" /etc/nebula/lighthouse.crt\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("key")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" /etc/nebula/lighthouse.key\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("static_host_map")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v('"192.168.250.1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"lighthouse1.example.com:4242"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("lighthouse")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("am_lighthouse")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("true")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#这行只有“灯塔”才有")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("interval")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("60")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 以下两行一定要注释掉")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#hosts:")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v('#  - "192.168.250.1"')]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("listen")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("host")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 0.0.0.0\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("4242")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("punchy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("punch")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("true")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("respond")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("true")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("tun")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 网卡名字")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("dev")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nbl\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("drop_local_broadcast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("false")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("drop_multicast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("false")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("tx_queue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("500")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("mtu")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1300")]),a._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("routes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#- mtu: 8800")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#  route: 10.0.0.0/16 #这里可以分发路由表，一行聚合不了的可以写多行，下面的覆盖上面的")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("logging")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("level")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" info\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("format")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" text\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("firewall")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("conntrack")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("tcp_timeout")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 120h\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("udp_timeout")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 3m\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("default_timeout")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 10m\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("max_connections")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("100000")]),a._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("outbound")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 放开所有出站")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" any\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("proto")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" any\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("host")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" any\n\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("inbound")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 放开各节点所有流量，这里可以有不同的粒度，甚至有类似云主机那种安全组的概念")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" any\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("proto")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" any\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("host")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" any\n")])])]),t("p",[a._v("运行")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("./nebula "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-config")]),a._v(" /etc/nebula/lighthouse-config.yaml\n")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);