(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{323:function(a,e,t){"use strict";t.r(e);var r=t(14),s=Object(r.a)({},(function(){var a=this,e=a._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"ocserv"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ocserv"}},[a._v("#")]),a._v(" ocserv")]),a._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://gitlab.com/openconnect/recipes",target:"_blank",rel:"noopener noreferrer"}},[a._v("recipes"),e("OutboundLink")],1)]),a._v(" "),e("li",[e("a",{attrs:{href:"https://openconnect.github.io/openconnect-gui/",target:"_blank",rel:"noopener noreferrer"}},[a._v("openconnect-gui"),e("OutboundLink")],1)]),a._v(" "),e("li",[e("a",{attrs:{href:"https://download.escope.net/Cisco/asa/vpn/",target:"_blank",rel:"noopener noreferrer"}},[a._v("AnyConnect"),e("OutboundLink")],1)]),a._v(" "),e("li",[e("a",{attrs:{href:"https://www.vps000.org/",target:"_blank",rel:"noopener noreferrer"}},[a._v("威伯斯云"),e("OutboundLink")],1)]),a._v(" "),e("li",[e("a",{attrs:{href:"https://v2ex.com/t/665868",target:"_blank",rel:"noopener noreferrer"}},[a._v("配置不代理局域网"),e("OutboundLink")],1)]),a._v(" "),e("li",[e("a",{attrs:{href:"https://github.com/CNMan/ocserv-cn-no-route",target:"_blank",rel:"noopener noreferrer"}},[a._v("ocserv-cn-no-route"),e("OutboundLink")],1)]),a._v(" "),e("li",[e("a",{attrs:{href:"https://yuerblog.cc/2020/11/21/%e5%ae%b6%e5%ba%ad%e6%90%ad%e5%bb%baopenconnect-vpn/",target:"_blank",rel:"noopener noreferrer"}},[a._v("家庭搭建openconnect vpn"),e("OutboundLink")],1)]),a._v(" "),e("li",[e("a",{attrs:{href:"https://beijing.bb/splitting-network-traffic-based-on-destinations/",target:"_blank",rel:"noopener noreferrer"}},[a._v("野生思科分离隧道"),e("OutboundLink")],1)]),a._v(" "),e("li",[e("a",{attrs:{href:"https://www.ioiox.com/archives/90.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("OpenWRT 路由器 OpenConnect VPN 详细图文教程"),e("OutboundLink")],1)]),a._v(" "),e("li",[e("a",{attrs:{href:"https://www.petenetlive.com/KB/Article/0000546",target:"_blank",rel:"noopener noreferrer"}},[a._v("VPN establishment capability for a remote user"),e("OutboundLink")],1)]),a._v(" "),e("li",[e("a",{attrs:{href:"https://blog.expta.com/2020/04/how-to-enable-cisco-anyconnect-vpn.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("through Remote Desktop"),e("OutboundLink")],1)])]),a._v(" "),e("p",[e("strong",[a._v("安装")])]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" update\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" ocserv\n")])])]),e("p",[e("strong",[a._v("ssl证书")])]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" /root/certificates\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /root/certificates\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# ca")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("tee")]),a._v(" /root/certificates/ca.tmpl "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<<-")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('\'EOF\'\ncn = "HX CA"\norganization = "HX"\nserial = 1\nexpiration_days = 3650\nca\nsigning_key\ncert_signing_key\ncrl_signing_key\nEOF')]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# user")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("tee")]),a._v(" /root/certificates/user.tmpl "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<<-")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('\'EOF\'\ncn = "huxins"\nunit = "HX"\nexpiration_days = 3650\nsigning_key\ntls_www_client\nEOF')]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# server")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("tee")]),a._v(" /root/certificates/server.tmpl "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<<-")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('\'EOF\'\ncn = "a sever\'s name, usually matches hostname"\norganization = "your organization"\nserial = 2\nexpiration_days = 3650\nsigning_key\nencryption_key\ntls_www_server\ndns_name = "your organization\'s host name"\n#ip_address = "if no hostname uncomment and set the IP address here"\nEOF')]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 生成CA证书")]),a._v("\ncerttool --generate-privkey "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--outfile")]),a._v(" ca-key.pem\ncerttool --generate-self-signed "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--hash")]),a._v(" SHA256 --load-privkey ca-key.pem "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--template")]),a._v(" ca.tmpl "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--outfile")]),a._v(" ca-cert.pem\ncerttool "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--infile")]),a._v(" ca-cert.pem\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 生成 Diffie-Hellman 密钥")]),a._v("\ncerttool --generate-dh-params "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--outfile")]),a._v(" /etc/ocserv/ssl/dh.pem\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# CA签发VPN证书")]),a._v("\ncerttool --generate-privkey "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--outfile")]),a._v(" server-key.pem\ncerttool --generate-certificate "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--hash")]),a._v(" SHA256 --load-privkey server-key.pem --load-ca-certificate ca-cert.pem --load-ca-privkey ca-key.pem "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--template")]),a._v(" server.tmpl "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--outfile")]),a._v(" server-cert.pem\ncerttool "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--infile")]),a._v(" user-cert.pem\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# CA签发用户证书")]),a._v("\ncerttool --generate-privkey "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--outfile")]),a._v(" user-key.pem\ncerttool --generate-certificate "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--hash")]),a._v(" SHA256 --load-privkey user-key.pem --load-ca-certificate ca-cert.pem --load-ca-privkey ca-key.pem "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--template")]),a._v(" user.tmpl "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--outfile")]),a._v(" user-cert.pem\ncerttool "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--infile")]),a._v(" user-cert.pem\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 证书链补全")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" /root/certificates/ca-cert.pem "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">>")]),a._v(" /root/certificates/user-cert.pem\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 生成.p12证书文件")]),a._v("\nopenssl pkcs12 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-export")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-inkey")]),a._v(" user-key.pem "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-in")]),a._v(" user-cert.pem "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-name")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"huxins"')]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-certfile")]),a._v(" ca-cert.pem "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-caname")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"HX CA"')]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-out")]),a._v(" huxins.AnyConnect.p12 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-passout")]),a._v(" pass:12345678\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 把VPN证书拷到ocserv配置目录下")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" server-cert.pem server-key.pem /etc/ocserv/\n")])])]),e("p",[e("strong",[a._v("配置")])]),a._v(" "),e("p",[a._v("/etc/ocserv/ocserv.conf")]),a._v(" "),e("div",{staticClass:"language-ini extra-class"},[e("pre",{pre:!0,attrs:{class:"language-ini"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("auth")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('"'),e("span",{pre:!0,attrs:{class:"token inner-value"}},[a._v("certificate")]),a._v('"')]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ca-cert")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/etc/ocserv/ca-cert.pem")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("cert-user-oid")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("2.5.4.3")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("server-cert")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/etc/ocserv/server-cert.pem")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("server-key")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/etc/ocserv/server-key.pem")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("tcp-port")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("443")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("udp-port")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("443")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ipv4-network")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("192.168.8.0")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ipv4-netmask")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("255.255.255.0")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("dns")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("8.8.8.8")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("no-route")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("172.26.201.0/255.255.255.0")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("route")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("192.168.11.0/255.255.255.0")]),a._v("\n")])])]),e("p",[e("strong",[a._v("创建VPN用户")])]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("ocpasswd "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" /etc/ocserv/ocpasswd myvpnuser\n")])])]),e("p",[e("strong",[a._v("VPN拨号")])]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" /etc/openconnect/password"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" openconnect "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-b")]),a._v(" https://YourORGVPNURL "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-u")]),a._v(" YourOrgVPNUsername --passwd-on-stdin\n")])])]),e("p",[e("strong",[a._v("VPN服务")])]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("ocserv "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" /etc/ocserv/ocserv.conf "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n")])])]),e("p",[e("strong",[a._v("防火墙")])]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("iptables "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-I")]),a._v(" POSTROUTING "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".100.0/24 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" MASQUERADE\niptables "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-I")]),a._v(" FORWARD "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v(" vpns+ "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".100.0/24 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT\niptables "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-I")]),a._v(" INPUT "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v(" vpns+ "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".100.0/24 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT\n\nfirewall-cmd "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--permanent")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--zone")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("public --add-port"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("443")]),a._v("/tcp\nfirewall-cmd "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--permanent")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--zone")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("public --add-port"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("443")]),a._v("/udp\nfirewall-cmd "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--permanent")]),a._v(" --add-masquerade\nfirewall-cmd "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--permanent")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--direct")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--passthrough")]),a._v(" ipv4 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" POSTROUTING "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" ens34 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" MASQUERADE\nfirewall-cmd "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--reload")]),a._v("\n")])])])])}),[],!1,null,null,null);e.default=s.exports}}]);