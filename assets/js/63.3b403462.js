(window.webpackJsonp=window.webpackJsonp||[]).push([[63],{347:function(t,a,s){"use strict";s.r(a);var n=s(14),e=Object(n.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"config"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#config"}},[t._v("#")]),t._v(" config")]),t._v(" "),a("p",[t._v("postgresql.conf")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SHOW")]),t._v(" config_file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SHOW")]),t._v(" data_directory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" pg_timezone_names"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("max_connections")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("show")]),t._v(" max_connections"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" pg_stat_activity"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" min_val"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" max_val "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" pg_settings "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'max_connections'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("password")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("su")]),t._v(" postgres\npsql "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-U")]),t._v(" postgres\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("password postgres\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("q\n")])])]),a("p",[t._v("remote")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vi /var/lib/pgsql/11/data/postgresql.conf")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 找到listen_addresses修改为：")]),t._v("\nlisten_addresses "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vi /var/lib/pgsql/11/data/pg_hba.conf")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# IPv4 local connections:")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("host")]),t._v("    all             all             "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0/0               md5\n")])])]),a("p",[t._v('psql: FATAL:  Peer authentication failed for user "postgres"')]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vi /var/lib/pgsql/11/data/pg_hba.conf")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Database administrative login by Unix domain socket")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("local")]),t._v("     all     postgres         peer\n改为\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("local")]),t._v("     all     postgres         trust\n")])])]),a("p",[t._v("template")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("UPDATE")]),t._v(" pg_database "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SET")]),t._v(" datistemplate "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("FALSE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" datname "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'template1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DROP")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DATABASE")]),t._v(" template1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DATABASE")]),t._v(" template1 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WITH")]),t._v(" TEMPLATE "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" template0 ENCODING "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'UNICODE'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("UPDATE")]),t._v(" pg_database "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SET")]),t._v(" datistemplate "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("TRUE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" datname "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'template1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("log")]),t._v(" "),a("div",{staticClass:"language-ini extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 是否将日志重定向至文件中")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("logging_collector")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("on")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 日志文件目录，默认是PGDATA的相对路径")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("log_directory")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("'"),a("span",{pre:!0,attrs:{class:"token inner-value"}},[t._v("log")]),t._v("'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  日志文件命名形式")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("log_filename")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("'"),a("span",{pre:!0,attrs:{class:"token inner-value"}},[t._v("postgresql-%Y-%m-%d.log")]),t._v("'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 单个日志文件的生存期，在日志文件大小没有达到log_rotation_size时，一天只生成一个日志文件")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("log_rotation_age")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("1d")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 单个日志文件的大小，如果时间没有超过log_rotation_age，一个日志文件最大只能到10M，否则将新生成一个日志文件")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("log_rotation_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("10MB")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 当日志文件已存在时，该配置如果为off，新生成的日志将在文件尾部追加，如果为on，则会覆盖原来的日志")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("log_truncate_on_rotation")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("off")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 会话等待时间超过deadlock_timeout而被锁时是否产生一个日志信息")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("log_lock_waits")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("off")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 记录每条SQL语句执行完成消耗的时间")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("log_duration")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("off")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置日志记录内容 none, ddl, mod, all")]),t._v("\nlog_statement\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 记录那些耗时超过（或等于）这个值（ms）的SQL语句")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("log_min_duration_statement")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("-1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 是否记录连接信息")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("log_connections")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("off")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 是否记录连接断开信息")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("log_disconnections")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("off")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 日志输出格式")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("log_line_prefix")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("'"),a("span",{pre:!0,attrs:{class:"token inner-value"}},[t._v("%m %p %u %d %r ")]),t._v("'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 日志时区")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("log_timezone")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("'"),a("span",{pre:!0,attrs:{class:"token inner-value"}},[t._v("Asia/Shanghai")]),t._v("'")]),t._v("\n")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);