(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{348:function(t,v,_){"use strict";_.r(v);var s=_(14),a=Object(s.a)({},(function(){var t=this,v=t._self._c;return v("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[v("h1",{attrs:{id:"json"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#json"}},[t._v("#")]),t._v(" json")]),t._v(" "),v("ul",[v("li",[v("a",{attrs:{href:"https://www.cnblogs.com/alianbog/p/5658156.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("JSON类型和函数"),v("OutboundLink")],1)]),t._v(" "),v("li",[v("a",{attrs:{href:"https://juejin.cn/post/6844903857009623048",target:"_blank",rel:"noopener noreferrer"}},[t._v("JSONB 使用入门"),v("OutboundLink")],1)])]),t._v(" "),v("h2",{attrs:{id:"json-jsonb"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#json-jsonb"}},[t._v("#")]),t._v(" json  jsonb")]),t._v(" "),v("p",[t._v("json 是对输入的完整拷贝，使用时再去解析，所以它会保留输入的空格，重复键以及顺序等。而 jsonb 是解析输入后保存的二进制，它在解析时会删除不必要的空格和重复的键，顺序和输入可能也不相同，使用时不用再次解析。两者对重复键的处理都是保留最后一个键值对。")]),t._v(" "),v("div",{staticClass:"language-sql extra-class"},[v("pre",{pre:!0,attrs:{class:"language-sql"}},[v("code",[v("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'{"bar": "baz", "balance":      7.77, "active":false}\'')]),t._v("::json"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),v("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'{"bar": "baz", "balance":      7.77, "active":false}\'')]),t._v("::jsonb"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),v("h2",{attrs:{id:"索引"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#索引"}},[t._v("#")]),t._v(" 索引")]),t._v(" "),v("p",[t._v("JSONB 最常用的是 "),v("code",[t._v("GIN")]),t._v(" 索引，GIN 索引可以被用来有效地搜索在大量 jsonb 文档（数据）中出现 的键或者键值对。")]),t._v(" "),v("div",{staticClass:"language-sql extra-class"},[v("pre",{pre:!0,attrs:{class:"language-sql"}},[v("code",[v("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INDEX")]),t._v(" idxgin "),v("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" table1 "),v("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("USING")]),t._v(" GIN "),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("column1"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),v("h2",{attrs:{id:"操作符"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#操作符"}},[t._v("#")]),t._v(" 操作符")]),t._v(" "),v("p",[t._v("json 和 jsonb 的操作符")]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("操作符")]),t._v(" "),v("th",[t._v("右操作数类型")]),t._v(" "),v("th",[t._v("描述")]),t._v(" "),v("th",[t._v("示例")]),t._v(" "),v("th",[t._v("结果")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("->")]),t._v(" "),v("td",[t._v("int")]),t._v(" "),v("td",[t._v("获取 JSON 数组元素（索引从0开始）")]),t._v(" "),v("td",[t._v('select \'[{"a":"foo"},{"b":"bar"},{"c":"baz"}]\'::json->2;')]),t._v(" "),v("td",[t._v('{"c":"baz"}')])]),t._v(" "),v("tr",[v("td",[t._v("->")]),t._v(" "),v("td",[t._v("text")]),t._v(" "),v("td",[t._v("通过键获取值")]),t._v(" "),v("td",[t._v('select \'{"a": {"b":"foo"}}\'::json->\'a\';')]),t._v(" "),v("td",[t._v('{"b":"foo"}')])]),t._v(" "),v("tr",[v("td",[t._v("->>")]),t._v(" "),v("td",[t._v("int")]),t._v(" "),v("td",[t._v("获取 JSON 数组元素为 text")]),t._v(" "),v("td",[t._v("select '[1,2,3]'::json->>2;")]),t._v(" "),v("td",[t._v("3")])]),t._v(" "),v("tr",[v("td",[t._v("->>")]),t._v(" "),v("td",[t._v("text")]),t._v(" "),v("td",[t._v("通过键获取值为 text")]),t._v(" "),v("td",[t._v("select '{\"a\":1,\"b\":2}'::json->>'b';")]),t._v(" "),v("td",[t._v("2")])]),t._v(" "),v("tr",[v("td",[t._v("#>")]),t._v(" "),v("td",[t._v("text[]")]),t._v(" "),v("td",[t._v("在指定的路径获取 JSON 对象")]),t._v(" "),v("td",[t._v('select \'{"a": {"b":{"c": "foo"}}}\'::json#>\'{a,b}\';')]),t._v(" "),v("td",[t._v('{"c": "foo"}')])]),t._v(" "),v("tr",[v("td",[t._v("#>>")]),t._v(" "),v("td",[t._v("text[]")]),t._v(" "),v("td",[t._v("在指定的路径获取 JSON 对象为 text")]),t._v(" "),v("td",[t._v("select '{\"a\":[1,2,3],\"b\":[4,5,6]}'::json#>>'{a,2}';")]),t._v(" "),v("td",[t._v("3")])])])]),t._v(" "),v("p",[t._v("jsonb 额外操作符")]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("操作符")]),t._v(" "),v("th",[t._v("右操作数类型")]),t._v(" "),v("th",[t._v("描述")]),t._v(" "),v("th",[t._v("示例")]),t._v(" "),v("th",[t._v("结果")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("@>")]),t._v(" "),v("td",[t._v("jsonb")]),t._v(" "),v("td",[t._v("左侧 json 最上层的值是否包含右边 json 对象")]),t._v(" "),v("td",[t._v('select \'{"a":1, "b":2}\'::jsonb @> \'{"b":2}\'::jsonb;')]),t._v(" "),v("td",[t._v("t")])]),t._v(" "),v("tr",[v("td",[t._v("<@")]),t._v(" "),v("td",[t._v("jsonb")]),t._v(" "),v("td",[t._v("左侧 json 对象是否包含于右侧 json 最上层的值内")]),t._v(" "),v("td",[t._v('select \'{"b":2}\'::jsonb <@ \'{"a":1, "b":2}\'::jsonb;')]),t._v(" "),v("td",[t._v("t")])]),t._v(" "),v("tr",[v("td",[t._v("?")]),t._v(" "),v("td",[t._v("text")]),t._v(" "),v("td",[t._v("text 是否作为左侧 Json 对象最上层的键")]),t._v(" "),v("td",[t._v("select '{\"a\":1, \"b\":2}'::jsonb ? 'b';")]),t._v(" "),v("td",[t._v("t")])]),t._v(" "),v("tr",[v("td",[t._v("?|")]),t._v(" "),v("td",[t._v("text[]")]),t._v(" "),v("td",[t._v("text[] 中的任一元素是否作为左侧 Json 对象最上层的键")]),t._v(" "),v("td",[t._v("select '{\"a\":1, \"b\":2, \"c\":3}'::jsonb ?| array['b', 'c'];")]),t._v(" "),v("td",[t._v("t")])]),t._v(" "),v("tr",[v("td",[t._v("?&")]),t._v(" "),v("td",[t._v("text[]")]),t._v(" "),v("td",[t._v("text[] 中的所有元素是否作为左侧 Json 对象最上层的键")]),t._v(" "),v("td",[t._v("select '[\"a\", \"b\"]'::jsonb ?& array['a', 'b'];")]),t._v(" "),v("td",[t._v("t")])]),t._v(" "),v("tr",[v("td",[t._v("||")]),t._v(" "),v("td",[t._v("jsonb")]),t._v(" "),v("td",[t._v("连接两个 json 对象，组成一个新的 json 对象")]),t._v(" "),v("td",[t._v('select \'["a", "b"]\'::jsonb || \'["c", "d"]\'::jsonb;')]),t._v(" "),v("td",[t._v('["a", "b", "c", "d"]')])]),t._v(" "),v("tr",[v("td",[t._v("-")]),t._v(" "),v("td",[t._v("text")]),t._v(" "),v("td",[t._v("删除左侧 json 对象中键为 text 的键值对")]),t._v(" "),v("td",[t._v("select '{\"a\": \"b\"}'::jsonb - 'a';")]),t._v(" "),v("td",[t._v("{}")])]),t._v(" "),v("tr",[v("td",[t._v("-")]),t._v(" "),v("td",[t._v("integer")]),t._v(" "),v("td",[t._v("删除数组指定索引处的元素，如果索引值为负数，则从右边计算索引值。如果最上层容器内不是数组，则抛出错误。")]),t._v(" "),v("td",[t._v('select \'["a", "b"]\'::jsonb - 1;')]),t._v(" "),v("td",[t._v('["a"]')])]),t._v(" "),v("tr",[v("td",[t._v("#-")]),t._v(" "),v("td",[t._v("text[]")]),t._v(" "),v("td",[t._v("删除指定路径下的域或元素（如果是json数组，且整数值是负的，则索引值从右边算起）")]),t._v(" "),v("td",[t._v("select '[\"a\", {\"b\":1}]'::jsonb #- '{1,b}';")]),t._v(" "),v("td",[t._v('["a", {}]')])])])])])}),[],!1,null,null,null);v.default=a.exports}}]);